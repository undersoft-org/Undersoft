@using System.ComponentModel.DataAnnotations
@using Undersoft.SDK.Instant.Proxies
@using Undersoft.SDK.Instant.Rubrics
@using Undersoft.SDK

@typeparam TModel where TModel : class, IOrigin, IInnerProxy

<div class="generics generic-form forms">
    <EditForm EditContext="@Context" FormName="generic_form">
        <DataAnnotationsValidator />
        @foreach (var _rubric in _rubrics.Where(r => r.Visible))
        {
            <!-- Auto Field -->
            <CascadingValue Value="@Model">
                <FluentStack Orientation="Orientation.Vertical" HorizontalAlignment="HorizontalAlignment.Center" VerticalAlignment="VerticalAlignment.Center" VerticalGap="20">
                    <GenericField TModel="TModel" Rubric="@_rubric" />
                </FluentStack>
            </CascadingValue>
        }
        <div style="color: var(--error);">
            <FluentValidationSummary />
        </div>
    </EditForm>
</div>

@code {
    private IRubrics _rubrics => _proxy.Rubrics;
    private IProxy _proxy => Model.Proxy;

    protected override void OnInitialized()
    {
        if (Context == null)
            Context = new EditContext(Model);
    }

    [Parameter]
    public EditContext Context { get; set; } = default!;

    [Parameter]
    public TModel Model { get; set; } = default!;
}

